import{useMemo as n,useState as o,useRef as e,useEffect as i,useCallback as t,Fragment as l,createElement as r}from"react";import{defaultMargin as u,getRelativeCursor as a,getDistance as d,Container as s,useDimensions as c,SvgWrapper as h,ResponsiveWrapper as v}from"@nivo/core";import{scaleLinear as f}from"d3-scale";import{Delaunay as p}from"d3-delaunay";import{useTooltip as M}from"@nivo/tooltip";import{jsx as g,jsxs as m,Fragment as b}from"react/jsx-runtime";function k(){return k=Object.assign?Object.assign.bind():function(n){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var i in e)({}).hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},k.apply(null,arguments)}var C={xDomain:[0,1],yDomain:[0,1],layers:["links","cells","points","bounds"],enableLinks:!1,linkLineWidth:1,linkLineColor:"#bbbbbb",enableCells:!0,cellLineWidth:2,cellLineColor:"#000000",enablePoints:!0,pointSize:4,pointColor:"#666666",role:"img"},y=function(n){return[n.x,n.y]},D=u,w="cursor",L="top",T=function(n){var o=n.points,e=n.getNodePosition,i=void 0===e?y:e,t=n.margin,l=void 0===t?D:t;return o.map((function(n){var o=i(n),e=o[0],t=o[1];return[e+l.left,t+l.top]}))},P=function(n){var o=n.points,e=n.width,i=n.height,t=n.margin,l=void 0===t?D:t,r=n.debug,u=p.from(o),a=r?u.voronoi([0,0,l.left+e+l.right,l.top+i+l.bottom]):void 0;return{points:o,delaunay:u,voronoi:a}},E=function(o){var e=o.points,i=o.getNodePosition,t=void 0===i?y:i,l=o.width,r=o.height,u=o.margin,a=void 0===u?D:u,d=o.debug;return n((function(){return P({points:T({points:e,margin:a,getNodePosition:t}),width:l,height:r,margin:a,debug:d})}),[t,e,l,r,a,d])},W=function(o){var e=o.data,i=o.width,t=o.height,l=o.xDomain,r=o.yDomain,u=n((function(){return f().domain(l).range([0,i])}),[l,i]),a=n((function(){return f().domain(r).range([0,t])}),[r,t]),d=n((function(){return e.map((function(n){return{x:u(n.x),y:a(n.y),data:n}}))}),[e,u,a]);return n((function(){var n=p.from(d.map((function(n){return[n.x,n.y]}))),o=n.voronoi([0,0,i,t]);return{points:d,delaunay:n,voronoi:o}}),[d,i,t])},x=function(o){var e=o.points,i=o.delaunay,t=o.voronoi;return n((function(){return{points:e,delaunay:i,voronoi:t}}),[e,i,t])},S=function(l){var r=l.elementRef,u=l.nodes,s=l.getNodePosition,c=void 0===s?y:s,h=l.delaunay,v=l.setCurrent,f=l.margin,p=void 0===f?D:f,g=l.detectionRadius,m=void 0===g?1/0:g,b=l.isInteractive,k=void 0===b||b,C=l.onMouseEnter,T=l.onMouseMove,P=l.onMouseLeave,E=l.onMouseDown,W=l.onMouseUp,x=l.onClick,S=l.onDoubleClick,R=l.onTouchStart,U=l.onTouchMove,A=l.onTouchEnd,N=l.enableTouchCrosshair,O=void 0!==N&&N,I=l.tooltip,j=l.tooltipPosition,z=void 0===j?w:j,F=l.tooltipAnchor,H=void 0===F?L:F,B=o(null),q=B[0],G=B[1],J=e(null);i((function(){J.current=q}),[J,q]);var K=t((function(n){if(!r.current||0===u.length)return null;var o=a(r.current,n),e=o[0],i=o[1],t=h.find(e,i),l=void 0!==t?u[t]:null;if(l&&m!==1/0){var s=c(l),v=s[0],f=s[1];d(e,i,v+p.left,f+p.top)>m&&(t=null,l=null)}return null===t||null===l?null:[t,l]}),[r,h,u,c,p,m]),Q=M(),V=Q.showTooltipAt,X=Q.showTooltipFromEvent,Y=Q.hideTooltip,Z=n((function(){if(I)return"cursor"===z?function(n,o){X(I(n),o,H)}:function(n){var o=c(n),e=o[0],i=o[1];V(I(n),[e+p.left,i+p.top],H)}}),[V,X,I,z,H,c,p]),$=t((function(n){var o=K(n);if(G(o),null==v||v(o?o[1]:null),o){var e=o[1];null==Z||Z(e,n),null==C||C(o[1],n)}}),[K,G,v,Z,C]),_=t((function(n){var o=K(n);if(G(o),o){var e=o[0],i=o[1];if(null==v||v(i),null==Z||Z(i,n),J.current){var t=J.current,l=t[0],r=t[1];e!==l?null==P||P(r,n):null==T||T(i,n)}else null==C||C(i,n)}else null==v||v(null),null==Y||Y(),J.current&&(null==P||P(J.current[1],n))}),[K,G,v,J,C,T,P,Z,Y]),nn=t((function(n){G(null),null==v||v(null),Y(),P&&J.current&&P(J.current[1],n)}),[G,v,J,Y,P]),on=t((function(n){var o=K(n);G(o),o&&(null==E||E(o[1],n))}),[K,G,E]),en=t((function(n){var o=K(n);G(o),o&&(null==W||W(o[1],n))}),[K,G,W]),tn=t((function(n){var o=K(n);G(o),o&&(null==x||x(o[1],n))}),[K,G,x]),ln=t((function(n){var o=K(n);G(o),o&&(null==S||S(o[1],n))}),[K,G,S]),rn=t((function(n){var o=K(n);O&&(G(o),null==v||v(o?o[1]:null)),o&&(null==R||R(o[1],n))}),[K,G,v,O,R]),un=t((function(n){var o=K(n);O&&(G(o),null==v||v(o?o[1]:null)),o&&(null==U||U(o[1],n))}),[K,G,v,O,U]),an=t((function(n){O&&(G(null),null==v||v(null)),A&&J.current&&A(J.current[1],n)}),[O,G,v,A,J]);return{current:q,handleMouseEnter:k?$:void 0,handleMouseMove:k?_:void 0,handleMouseLeave:k?nn:void 0,handleMouseDown:k?on:void 0,handleMouseUp:k?en:void 0,handleClick:k?tn:void 0,handleDoubleClick:k?ln:void 0,handleTouchStart:k?rn:void 0,handleTouchMove:k?un:void 0,handleTouchEnd:k?an:void 0}},R=function(n){var o=n.elementRef,e=n.nodes,i=n.getNodePosition,t=n.width,l=n.height,r=n.margin,u=void 0===r?D:r,a=n.isInteractive,d=void 0===a||a,s=n.detectionRadius,c=void 0===s?1/0:s,h=n.setCurrent,v=n.onMouseEnter,f=n.onMouseMove,p=n.onMouseLeave,M=n.onMouseDown,g=n.onMouseUp,m=n.onClick,b=n.onDoubleClick,k=n.tooltip,C=n.tooltipPosition,y=void 0===C?w:C,T=n.tooltipAnchor,P=void 0===T?L:T,W=n.debug,x=E({points:e,getNodePosition:i,width:t,height:l,margin:u,debug:void 0!==W&&W}),R=x.delaunay,U=x.voronoi,A=S({elementRef:o,nodes:e,margin:u,setCurrent:h,delaunay:R,detectionRadius:c,isInteractive:d,onMouseEnter:v,onMouseMove:f,onMouseLeave:p,onMouseDown:M,onMouseUp:g,onClick:m,onDoubleClick:b,tooltip:k,tooltipPosition:y,tooltipAnchor:P}),N=A.handleMouseEnter,O=A.handleMouseMove,I=A.handleMouseLeave,j=A.handleMouseDown,z=A.handleMouseUp,F=A.handleClick,H=A.handleDoubleClick;return{delaunay:R,voronoi:U,current:A.current,handleMouseEnter:N,handleMouseMove:O,handleMouseLeave:I,handleMouseDown:j,handleMouseUp:z,handleClick:F,handleDoubleClick:H}},U=["theme"],A=function(n){var o=n.data,e=n.width,i=n.height,t=n.margin,u=n.layers,a=void 0===u?C.layers:u,d=n.xDomain,s=void 0===d?C.xDomain:d,v=n.yDomain,f=void 0===v?C.yDomain:v,p=n.enableLinks,M=void 0===p?C.enableLinks:p,m=n.linkLineWidth,b=void 0===m?C.linkLineWidth:m,k=n.linkLineColor,y=void 0===k?C.linkLineColor:k,D=n.enableCells,w=void 0===D?C.enableCells:D,L=n.cellLineWidth,T=void 0===L?C.cellLineWidth:L,P=n.cellLineColor,E=void 0===P?C.cellLineColor:P,S=n.enablePoints,R=void 0===S?C.enableCells:S,U=n.pointSize,A=void 0===U?C.pointSize:U,N=n.pointColor,O=void 0===N?C.pointColor:N,I=n.role,j=void 0===I?C.role:I,z=c(e,i,t),F=z.outerWidth,H=z.outerHeight,B=z.margin,q=z.innerWidth,G=z.innerHeight,J=W({data:o,width:q,height:G,xDomain:s,yDomain:f}),K=J.points,Q=J.delaunay,V=J.voronoi,X={links:null,cells:null,points:null,bounds:null};M&&a.includes("links")&&(X.links=g("path",{stroke:y,strokeWidth:b,fill:"none",d:Q.render()},"links")),w&&a.includes("cells")&&(X.cells=g("path",{d:V.render(),fill:"none",stroke:E,strokeWidth:T},"cells")),R&&a.includes("points")&&(X.points=g("path",{stroke:"none",fill:O,d:Q.renderPoints(void 0,A/2)},"points")),a.includes("bounds")&&(X.bounds=g("path",{fill:"none",stroke:E,strokeWidth:T,d:V.renderBounds()},"bounds"));var Y=x({points:K,delaunay:Q,voronoi:V});return g(h,{width:F,height:H,margin:B,role:j,children:a.map((function(n,o){return void 0!==X[n]?X[n]:"function"==typeof n?g(l,{children:r(n,Y)},o):null}))})},N=function(n){var o=n.theme,e=function(n,o){if(null==n)return{};var e={};for(var i in n)if({}.hasOwnProperty.call(n,i)){if(-1!==o.indexOf(i))continue;e[i]=n[i]}return e}(n,U);return g(s,{isInteractive:!1,animate:!1,theme:o,children:g(A,k({},e))})},O=function(n){return g(v,{children:function(o){var e=o.width,i=o.height;return g(N,k({width:e,height:i},n))}})},I=function(o){var i=o.nodes,t=o.width,l=o.height,r=o.margin,u=void 0===r?D:r,a=o.getNodePosition,d=o.setCurrent,s=o.onMouseEnter,c=o.onMouseMove,h=o.onMouseLeave,v=o.onMouseDown,f=o.onMouseUp,p=o.onClick,M=o.onDoubleClick,k=o.onTouchStart,C=o.onTouchMove,y=o.onTouchEnd,T=o.enableTouchCrosshair,P=void 0!==T&&T,W=o.detectionRadius,x=void 0===W?1/0:W,R=o.tooltip,U=o.tooltipPosition,A=void 0===U?w:U,N=o.tooltipAnchor,O=void 0===N?L:N,I=o.debug,j=e(null),z=E({points:i,getNodePosition:a,width:t,height:l,margin:u,debug:I}),F=z.delaunay,H=z.voronoi,B=S({elementRef:j,nodes:i,delaunay:F,margin:u,detectionRadius:x,setCurrent:d,onMouseEnter:s,onMouseMove:c,onMouseLeave:h,onMouseDown:v,onMouseUp:f,onClick:p,onDoubleClick:M,onTouchStart:k,onTouchMove:C,onTouchEnd:y,enableTouchCrosshair:P,tooltip:R,tooltipPosition:A,tooltipAnchor:O}),q=B.current,G=B.handleMouseEnter,J=B.handleMouseMove,K=B.handleMouseLeave,Q=B.handleMouseDown,V=B.handleMouseUp,X=B.handleClick,Y=B.handleDoubleClick,Z=B.handleTouchStart,$=B.handleTouchMove,_=B.handleTouchEnd,nn=n((function(){if(I&&H)return H.render()}),[I,H]);return m("g",{ref:j,transform:"translate("+-u.left+","+-u.top+")",children:[I&&H&&m(b,{children:[g("path",{d:nn,stroke:"red",strokeWidth:1,opacity:.75}),x<1/0&&g("path",{stroke:"red",strokeWidth:.35,fill:"none",d:F.renderPoints(void 0,x)}),q&&g("path",{fill:"pink",opacity:.35,d:H.renderCell(q[0])})]}),g("rect",{"data-ref":"mesh-interceptor",width:u.left+t+u.right,height:u.top+l+u.bottom,fill:"red",opacity:0,style:{cursor:"auto"},onMouseEnter:G,onMouseMove:J,onMouseLeave:K,onMouseDown:Q,onMouseUp:V,onTouchStart:Z,onTouchMove:$,onTouchEnd:_,onClick:X,onDoubleClick:Y})]})},j=function(n,o){n.save(),n.globalAlpha=.75,n.beginPath(),o.render(n),n.strokeStyle="red",n.lineWidth=1,n.stroke(),n.restore()},z=function(n,o,e){n.save(),n.globalAlpha=.15,n.beginPath(),o.renderPoints(n,e),n.strokeStyle="red",n.lineWidth=1,n.stroke(),n.restore()},F=function(n,o,e){n.save(),n.globalAlpha=.35,n.beginPath(),o.renderCell(e,n),n.fillStyle="pink",n.fill(),n.restore()},H=function(n,o){var e=o.delaunay,i=o.voronoi,t=o.detectionRadius,l=o.index;j(n,i),t<1/0&&z(n,e,t),null!==l&&F(n,i,l)};export{I as Mesh,O as ResponsiveVoronoi,N as Voronoi,P as computeMesh,T as computeMeshPoints,C as defaultVoronoiProps,H as renderDebugToCanvas,z as renderDelaunayPointsToCanvas,F as renderVoronoiCellToCanvas,j as renderVoronoiToCanvas,R as useMesh,S as useMeshEvents,W as useVoronoi,x as useVoronoiLayerContext,E as useVoronoiMesh};
//# sourceMappingURL=nivo-voronoi.mjs.map
